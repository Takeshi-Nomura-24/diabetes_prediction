{% extends 'base.html' %}

{% block main %}
<div class="container mt-2 mt-md-4 mb-5">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 text-center text-md-start">
        <h2 class="fw-bold text-dark h4 h-md-2 mb-2 mb-md-0">
            <i class="bi bi-database-fill-gear text-primary"></i> 診断履歴データベース
        </h2>
        <span class="badge bg-secondary py-2 px-3">全 {{ diabetes_data|length }} 件のデータ</span>
    </div>

    <div class="d-none d-md-block card shadow-sm border-0 rounded-4 overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-dark">
                    <tr>
                        <th class="px-3 text-nowrap">ID</th>
                        <th class="text-nowrap">判定日時</th>
                        <th class="text-nowrap text-center">判定結果</th>
                        <th class="text-nowrap">血糖値</th>
                        <th class="text-nowrap">BMI</th>
                        <th class="text-nowrap">年齢</th>
                        <th class="text-nowrap">妊娠</th>
                        <th class="text-nowrap">血圧</th>
                        <th class="text-nowrap">皮下脂肪</th>
                        <th class="text-nowrap">インスリン</th>
                        <th class="text-nowrap">家系指数</th>
                    </tr>
                </thead>
                <tbody>
                    {% for data in diabetes_data %}
                    <tr>
                        <td class="px-3 fw-bold text-primary">#{{ data.id }}</td>
                        <td class="small text-muted">{{ data.created_at|date:"Y/m/d H:i" }}</td>
                        <td class="text-center">
                            {% if "陽性" in data.Result or "Positive" in data.Result or data.Result == "1" %}
                            <span class="badge rounded-pill bg-danger shadow-sm px-3">陽性</span>
                            {% else %}
                            <span class="badge rounded-pill bg-success shadow-sm px-3">陰性</span>
                            {% endif %}
                        </td>
                        <td>{{ data.Glucose }}</td>
                        <td>{{ data.BMI }}</td>
                        <td>{{ data.Age }}歳</td>
                        <td>{{ data.Pregnancies }}</td>
                        <td>{{ data.Blood_Pressure }}</td>
                        <td>{{ data.Skin_Thickness }}</td>
                        <td>{{ data.Insulin }}</td>
                        <td>{{ data.Diabetes_Pedigree_Function }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="11" class="text-center py-5 text-muted">
                            <i class="bi bi-info-circle me-2"></i> 登録されている履歴がありません。
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="d-md-none">
        {% for data in diabetes_data %}
        <div class="card shadow-sm border-0 mb-3 rounded-4 overflow-hidden border-start border-5 {% if '陽性' in data.Result or 'Positive' in data.Result or data.Result == '1' %}border-danger{% else %}border-success{% endif %}">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <div class="fw-bold text-primary">#{{ data.id }}</div>
                        <div class="small text-muted"><i class="bi bi-clock"></i> {{ data.created_at|date:"Y/m/d H:i" }}</div>
                    </div>
                    {% if "陽性" in data.Result or "Positive" in data.Result or data.Result == "1" %}
                    <span class="badge bg-danger px-3 py-2">陽性</span>
                    {% else %}
                    <span class="badge bg-success px-3 py-2">陰性</span>
                    {% endif %}
                </div>

                <div class="row g-2 text-center bg-light rounded-3 p-2 mb-3 mx-0">
                    <div class="col-4 border-end">
                        <div class="text-muted tiny-label">血糖値</div>
                        <div class="fw-bold">{{ data.Glucose }}</div>
                    </div>
                    <div class="col-4 border-end">
                        <div class="text-muted tiny-label">BMI</div>
                        <div class="fw-bold">{{ data.BMI }}</div>
                    </div>
                    <div class="col-4">
                        <div class="text-muted tiny-label">年齢</div>
                        <div class="fw-bold">{{ data.Age }}</div>
                    </div>
                </div>

                <div class="row g-2 px-1">
                    <div class="col-6 small text-muted">妊娠回数: <span class="text-dark fw-bold">{{ data.Pregnancies }}</span></div>
                    <div class="col-6 small text-muted">血圧: <span class="text-dark fw-bold">{{ data.Blood_Pressure }}</span></div>
                    <div class="col-6 small text-muted">皮下脂肪: <span class="text-dark fw-bold">{{ data.Skin_Thickness }}</span></div>
                    <div class="col-6 small text-muted">インスリン: <span class="text-dark fw-bold">{{ data.Insulin }}</span></div>
                    <div class="col-12 small text-muted mt-1">家系指数: <span class="text-dark fw-bold">{{ data.Diabetes_Pedigree_Function }}</span></div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-5 bg-white rounded-4 shadow-sm">
            <i class="bi bi-database-exclamation display-4 text-light"></i>
            <p class="text-muted mt-2">履歴がありません</p>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    /* スマホ用ラベルの極小フォント設定 */
    .tiny-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    /* カード内の行間調整 */
    .card-body p {
        margin-bottom: 0.5rem;
    }

    /* PC版テーブルの微調整 */
    .table th {
        font-weight: 600;
        font-size: 0.85rem;
    }
</style>
{% endblock %}